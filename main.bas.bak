10 remBBR
20 poke52,28:poke56,28:clr:gosub320:poke36879,221:deffnrn(a)=int(rnd(1)*a)
40 dimsd(7):dimcd(7):hv=7680:bh=43:fc=4:fi=42:hc=2:bc=7:si=32:pp=3
50 ch=38400:sz=483:dimbi(7):bp=7681:lp=hv:rw=0:cl=1:tg=0:lr=5:lf=0:uc=0:ui=41
70 gosub350:gosub590:gosub1030:printchr$(147):gosub430:gosub520
90 remhve
100 gosub380:gosub620
110 pr=lr:lr=1:gosub700:lr=pr
120 remlk
130 iftg=0thengosub700
140 remrnd
150 iftg=0thengosub550
160 gosub960
170 fd=dr:ld=7:s=1
180 fori=fdtoldsteps:c=peek(bp+sd(i))
200 if(tg=hvand(c=bhorc=si))or(tg<>hvand(c=siorc=fi))thendr=i:goto230:nexti
220 fd=dr:ld=0:s=-1:goto180
230 ifdr>=0anddr<=7thenbp=bp+sd(dr):ifbp<>lpthengosub620
250 geta$:ifa$<>""thengoto290
260 ifbp=tgthentg=0:ifbp=hvthengosub940:goto90
280 if(nf>0)and(pp>0)thengoto110
290 printchr$(147):poke36869,240:poke36879,27:end
320 remcp
330 fori=7168to7679:pokei,peek(i+25600):nexti:return
350 remch
360 fori=0to87:readz:poke7432+i,z:nexti:poke36869,255
370 return
380 remhv
390 tg=lf:pokehv,bh:pokech,hc:return
430 remflw
440 nf=fnrn(11)+5:forro=1tonf:fp=int(rnd(0)*sz)+1:pokehv+fp,fi:pokech+fp,fc
490 nextro:return
510 rempos
520 ifbp<hvorbp>hv+szthenbp=hv+1
530 rw=int((bp-hv)/22):cl=bp-(hv+(rw*22)):return
550 remrnd
560 rd=fnrn(7):ifsd(rd)=0orbp+sd(rd)>hv+szorbp+sd(rd)=hvthengoto560
580 tg=bp+sd(rd):return
590 remdrs
600 fori=0to7:readcd(i):nexti:return
620 remb
630 ifpeek(bp)=fithentg=hv:gosub920:ifpeek(bp)=uithengosub1079
640 iflp<>hvthenpokelp,si
650 ifbp<>hvthenpokebp,bi(dr):pokech+(bp-hv),bc:lp=bp
680 gosub510:v=36874:f=128:gosub1065:return
700 remlk
710 ford=0to7
720 fori=bptobp+(cd(d)*lr)stepcd(d)
730 ifi<hv-1ori>hv+szthen830
740 tr=int((i-hv)/22):tc=i-(hv+(tr*22))
750 ifd>0andd<4andtc<clthen830
760 ifd<=7andd>4andtc>clthen830
770 ifpeek(i)=fithentg=i:iflr>1thenreturn
780 ifbp=iorlr=1thengoto810
790 oc=peek(i):os=peek(ch+(i-hv)):pokei,46:pokech+(i-hv),3
800 forx=0to5:nextx:pokei,oc:pokech+(i-hv),os
810 nexti
820 sd(d)=cd(d):goto840
830 iflr=1thensd(d)=0
840 nextd:return
860 remmg
870 print"{down*20}":forx=len(mg$)to20:mg$=mg$+chr$(si):nextx
890 printleft$(mg$,20);:print"{home}":return
920 lf=bp:nf=nf-1:pp=pp+1:lr=lr+(pp-3):gosub1060:mg$="pp "+l$:gosub860:gosub1069
930 return
940 tg=lf:gosub960:pokehv+up,si:return
960 remdr
970 tr=int((tg-hv)/22):tc=tg-(hv+(tr*22)):dr=abs((tr<rw)and(tc=cl))*0
980 dr=dr+abs((tr<rw)and(tc>cl))*1:dr=dr+abs((tr=rw)and(tc>cl))*2
990 dr=dr+abs((tr>rw)and(tc>cl))*3:dr=dr+abs((tr>rw)and(tc=cl))*4
1000 dr=dr+abs((tr>rw)and(tc<cl))*5:dr=dr+abs((tr=rw)and(tc<cl))*6
1010 dr=dr+abs((tr<rw)and(tc<cl))*7:return
1030 remdi
1040 fori=0to7:readbi(i):nexti:return
1060 l$="{green}":forx=1topp:l$=l$+"*":next:l$=l$+"{blue}":return
1065 rembz
1068 poke36878,15:pokev,f:forx=1to100:next:poke36878,0:return
1069 up=int(rnd(0)*sz)+1:pokehv+up,ui:pokech+((hv+up)-hv),uc:return
1079 pp=pp-1:v=36876:f=255:gosub1069:v=36874:f=128:return
1200 data8,28,28,99,127,34,62,8
1210 data,1,110,118,42,52,94,102
1220 data,24,120,86,215,86,120,24
1230 data,204,188,104,84,236,220,2
1240 data8,62,34,127,99,28,28,8
1250 data102,122,44,84,110,118,128,
1260 data24,30,106,235,106,30,24,
1270 data64,59,55,42,22,61,51,
1280 data195,255,90,126,102,90,60,
1290 data8,28,42,119,42,8,8,28
1300 data,24,60,102,66,126,66,90
1310 data-22,-21,1,23,22,21,-1,-23
1320 data33,34,35,36,37,38,39,40